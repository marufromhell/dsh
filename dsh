#!/usr/bin/env python3
import serial
import click

"""
Flipper Zero shell script runner
email: maru@lithium-dev.xyz (pgp attached)
signal: maru.222
BTC: 16innLYQtz123HTwNLY3vScPmEVP7tob8u
ETH: 0x48994D78B7090367Aa20FD5470baDceec42cAF62 
XMR: 49dNpgP5QSpPDF1YUVuU3ST2tUWng32m8crGQ4NuM6U44CG1ennTvESWbwK6epkfJ6LuAKYjSDKqKNtbtJnU71gi6GrF4Wh
"""

@click.command()
@click.option('-p', '--port', default='0', show_default=True, help='Serial port number')
@click.argument('script')
def main(port, script):
    with open(script, "r", encoding="utf-8") as file:
        contents = file.read()

    ser = serial.Serial(f"/dev/ttyACM{port}", 115200, timeout=1)
    ser.write(b'\n\r')

    click.echo("connected to: " + ser.portstr)

    for line in contents.splitlines():
        ser.write(line.encode('utf-8') + b'\n\r')
        click.echo(ser.readline())

if __name__ == '__main__':
    main()

